(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const vr=[{stylers:[{hue:"#00ffe6"},{saturation:-70},{lightness:10},{gamma:1}]},{featureType:"administrative",stylers:[{gamma:0},{visibility:"simplified"}]},{featureType:"road.local",stylers:[{gamma:-30},{visibility:"on"},{strokeWeight:3},{strokeColor:"black"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",elementType:"labels.text",stylers:[{visibility:"on"}]},{featureType:"landscape.man_made",stylers:[{visibility:"simplified"}]},{featureType:"transit",stylers:[{visibility:"off"}]}];class wr{constructor(n,e,r,i,o,a){const s=this;s.map=null,s.overlay=null,s.locationData=n,s.onlineMentions=e,s.personInfo=r,s.localMentions=i,s.currentInfoWindow=null,s.currentLocation=null,s.openInfoWindowCallbacks={},s.markers=[],s.onMarkerClick=o,s.onCloseInfoWindow=a,s.addMarkerStyles()}addMarkerStyles(){const n=document.createElement("style");n.textContent=`
      .marker {
        position: absolute;
        cursor: pointer;
      }
      .marker circle {
        stroke: #000;
        stroke-width: 1px;
      }
      .marker text {
        fill: black;
        font: 10px sans-serif;
        text-anchor: start;
      }
      .info-window {
        padding: 10px;
        max-width: 200px;
      }
      .info-window h3 {
        margin-top: 0;
        font-size: 14px;
      }
      .info-window p {
        margin-bottom: 5px;
        font-size: 12px;
      }
    `,document.head.appendChild(n)}initVis(){const n=this;n.initMap(),n.wrangleData()}initMap(){const n=this;if(!document.getElementById("map")){const r=document.createElement("div");r.id="map",r.style.width="100%",r.style.height="500px",document.getElementById("visualization").appendChild(r)}n.map=new google.maps.Map(document.getElementById("map"),{zoom:11,center:new google.maps.LatLng(43.6532,-79.3832),mapTypeId:google.maps.MapTypeId.ROADMAP}),n.map.setOptions({styles:vr});const e=document.createElement("div");e.id="legend",e.innerHTML=`<div class="p-2.5 mr-2 shadow-sm" style="background-color:white;">
        <h5>Legend</h5>
        <div class="flex gap-1 items-center"><div class="min-w-2 min-h-2" style="background-color: #2196F3"></div><span>Online</span></div>
        <div class="flex gap-1 items-center"><div class="min-w-2 min-h-2" style="background-color: #4CAF50"></div><span>Local</span></div>
        <div class="flex gap-1 items-center"><div class="min-w-2 min-h-2" style="background-color: #9932CC"></div><span>Both</span></div>
    </div>`,n.map.controls[google.maps.ControlPosition.RIGHT_TOP].push(e)}wrangleData(){const n=this;n.validLocations=n.locationData.filter(e=>e.latitude!==null&&e.longitude!==null),n.updateVis(null)}updateVis(n,e,r){const i=this;i.markers.forEach(a=>a.setMap(null)),i.markers=[];const o=new google.maps.InfoWindow;i.openInfoWindowCallbacks={},i.validLocations&&i.validLocations.length>0&&i.validLocations.forEach(a=>{if(n&&!i.localMentions.some(b=>b.location_id===a.location_id&&b.Person===n)||e&&a.location_id!==e||r&&a.category!==r)return;const s=n?!0:i.hasLocalMention(a.location_id),u=i.getOnlineMentionCount(a.location_id)>0;let l="#888888";s&&u?l="#9932CC":s?l="#4CAF50":u&&(l="#2196F3");const c=i.getOnlineMentionCount(a.location_id),h=Math.max(4,Math.min(10,4+c/4)),f={path:google.maps.SymbolPath.CIRCLE,fillColor:l,fillOpacity:.7,strokeWeight:1,strokeColor:"#000000",scale:h},g=new google.maps.Marker({position:new google.maps.LatLng(a.latitude,a.longitude),map:i.map,title:a.name,icon:f,optimized:!1}),x=()=>i.showInfoWindow(a,o,g);i.openInfoWindowCallbacks[a.location_id]=x,g.addListener("click",()=>{const y=x();this.onMarkerClick(y)}),i.markers.push(g)}),o.addListener("closeclick",()=>{this.onCloseInfoWindow(i.currentLocation)})}getOnlineMentionCount(n){const r=this.onlineMentions.find(i=>i.location_id===n);return r?r.count:0}hasLocalMention(n){return this.localMentions.some(r=>r.location_id===n)}showInfoWindow(n,e,r){const i=this,o=i.getOnlineMentionCount(n.location_id);i.hasLocalMention(n.location_id);const a=i.localMentions.filter(l=>l.location_id===n.location_id),s=a.map(l=>l.Person).join(", ")||"N/A",u=`
      <div class="info-window">
        <h3>${n.name}</h3>
        <p><strong>Category:</strong> ${n.category||"N/A"}</p>
        <p><strong>Cost:</strong> ${n.cost||"N/A"}</p>
        <p><strong>Online Mentions:</strong> ${o}</p>
        <p><strong>Recommended by:</strong> ${s}</p>
        <p><strong>Address:</strong> ${n.address||"N/A"}</p>
      </div>
    `;return e.setContent(u),e.open(i.map,r),i.currentInfoWindow=e,i.currentLocation=n,a}closeInfoWindow(){this.currentInfoWindow&&this.currentInfoWindow.close()}openInfoWindow(n){n in this.openInfoWindowCallbacks&&this.openInfoWindowCallbacks[n]()}}function Ht(t,n){return t==null||n==null?NaN:t<n?-1:t>n?1:t>=n?0:NaN}function _r(t,n){return t==null||n==null?NaN:n<t?-1:n>t?1:n>=t?0:NaN}function Ie(t){let n,e,r;t.length!==2?(n=Ht,e=(s,u)=>Ht(t(s),u),r=(s,u)=>t(s)-u):(n=t===Ht||t===_r?t:br,e=t,r=t);function i(s,u,l=0,c=s.length){if(l<c){if(n(u,u)!==0)return c;do{const h=l+c>>>1;e(s[h],u)<0?l=h+1:c=h}while(l<c)}return l}function o(s,u,l=0,c=s.length){if(l<c){if(n(u,u)!==0)return c;do{const h=l+c>>>1;e(s[h],u)<=0?l=h+1:c=h}while(l<c)}return l}function a(s,u,l=0,c=s.length){const h=i(s,u,l,c-1);return h>l&&r(s[h-1],u)>-r(s[h],u)?h-1:h}return{left:i,center:a,right:o}}function br(){return 0}function Mr(t){return t===null?NaN:+t}const kr=Ie(Ht),$r=kr.right;Ie(Mr).center;class Gn extends Map{constructor(n,e=Nr){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),n!=null)for(const[r,i]of n)this.set(r,i)}get(n){return super.get(Un(this,n))}has(n){return super.has(Un(this,n))}set(n,e){return super.set(Ar(this,n),e)}delete(n){return super.delete(Cr(this,n))}}function Un({_intern:t,_key:n},e){const r=n(e);return t.has(r)?t.get(r):e}function Ar({_intern:t,_key:n},e){const r=n(e);return t.has(r)?t.get(r):(t.set(r,e),e)}function Cr({_intern:t,_key:n},e){const r=n(e);return t.has(r)&&(e=t.get(r),t.delete(r)),e}function Nr(t){return t!==null&&typeof t=="object"?t.valueOf():t}const Sr=Math.sqrt(50),Er=Math.sqrt(10),Ir=Math.sqrt(2);function Jt(t,n,e){const r=(n-t)/Math.max(0,e),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),a=o>=Sr?10:o>=Er?5:o>=Ir?2:1;let s,u,l;return i<0?(l=Math.pow(10,-i)/a,s=Math.round(t*l),u=Math.round(n*l),s/l<t&&++s,u/l>n&&--u,l=-l):(l=Math.pow(10,i)*a,s=Math.round(t/l),u=Math.round(n/l),s*l<t&&++s,u*l>n&&--u),u<s&&.5<=e&&e<2?Jt(t,n,e*2):[s,u,l]}function Tr(t,n,e){if(n=+n,t=+t,e=+e,!(e>0))return[];if(t===n)return[t];const r=n<t,[i,o,a]=r?Jt(n,t,e):Jt(t,n,e);if(!(o>=i))return[];const s=o-i+1,u=new Array(s);if(r)if(a<0)for(let l=0;l<s;++l)u[l]=(o-l)/-a;else for(let l=0;l<s;++l)u[l]=(o-l)*a;else if(a<0)for(let l=0;l<s;++l)u[l]=(i+l)/-a;else for(let l=0;l<s;++l)u[l]=(i+l)*a;return u}function wn(t,n,e){return n=+n,t=+t,e=+e,Jt(t,n,e)[2]}function Rr(t,n,e){n=+n,t=+t,e=+e;const r=n<t,i=r?wn(n,t,e):wn(t,n,e);return(r?-1:1)*(i<0?1/-i:i)}function Te(t,n){let e;if(n===void 0)for(const r of t)r!=null&&(e<r||e===void 0&&r>=r)&&(e=r);else{let r=-1;for(let i of t)(i=n(i,++r,t))!=null&&(e<i||e===void 0&&i>=i)&&(e=i)}return e}function Lr(t,n,e){t=+t,n=+n,e=(i=arguments.length)<2?(n=t,t=0,1):i<3?1:+e;for(var r=-1,i=Math.max(0,Math.ceil((n-t)/e))|0,o=new Array(i);++r<i;)o[r]=t+r*e;return o}function Pr(t){return t}var dn=1,gn=2,_n=3,Ct=4,Jn=1e-6;function Or(t){return"translate("+t+",0)"}function zr(t){return"translate(0,"+t+")"}function Br(t){return n=>+t(n)}function Vr(t,n){return n=Math.max(0,t.bandwidth()-n*2)/2,t.round()&&(n=Math.round(n)),e=>+t(e)+n}function Dr(){return!this.__axis}function Re(t,n){var e=[],r=null,i=null,o=6,a=6,s=3,u=typeof window<"u"&&window.devicePixelRatio>1?0:.5,l=t===dn||t===Ct?-1:1,c=t===Ct||t===gn?"x":"y",h=t===dn||t===_n?Or:zr;function f(g){var x=r??(n.ticks?n.ticks.apply(n,e):n.domain()),y=i??(n.tickFormat?n.tickFormat.apply(n,e):Pr),b=Math.max(o,0)+s,M=n.range(),I=+M[0]+u,$=+M[M.length-1]+u,m=(n.bandwidth?Vr:Br)(n.copy(),u),d=g.selection?g.selection():g,p=d.selectAll(".domain").data([null]),_=d.selectAll(".tick").data(x,n).order(),k=_.exit(),T=_.enter().append("g").attr("class","tick"),S=_.select("line"),w=_.select("text");p=p.merge(p.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),_=_.merge(T),S=S.merge(T.append("line").attr("stroke","currentColor").attr(c+"2",l*o)),w=w.merge(T.append("text").attr("fill","currentColor").attr(c,l*b).attr("dy",t===dn?"0em":t===_n?"0.71em":"0.32em")),g!==d&&(p=p.transition(g),_=_.transition(g),S=S.transition(g),w=w.transition(g),k=k.transition(g).attr("opacity",Jn).attr("transform",function(E){return isFinite(E=m(E))?h(E+u):this.getAttribute("transform")}),T.attr("opacity",Jn).attr("transform",function(E){var v=this.parentNode.__axis;return h((v&&isFinite(v=v(E))?v:m(E))+u)})),k.remove(),p.attr("d",t===Ct||t===gn?a?"M"+l*a+","+I+"H"+u+"V"+$+"H"+l*a:"M"+u+","+I+"V"+$:a?"M"+I+","+l*a+"V"+u+"H"+$+"V"+l*a:"M"+I+","+u+"H"+$),_.attr("opacity",1).attr("transform",function(E){return h(m(E)+u)}),S.attr(c+"2",l*o),w.attr(c,l*b).text(y),d.filter(Dr).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",t===gn?"start":t===Ct?"end":"middle"),d.each(function(){this.__axis=m})}return f.scale=function(g){return arguments.length?(n=g,f):n},f.ticks=function(){return e=Array.from(arguments),f},f.tickArguments=function(g){return arguments.length?(e=g==null?[]:Array.from(g),f):e.slice()},f.tickValues=function(g){return arguments.length?(r=g==null?null:Array.from(g),f):r&&r.slice()},f.tickFormat=function(g){return arguments.length?(i=g,f):i},f.tickSize=function(g){return arguments.length?(o=a=+g,f):o},f.tickSizeInner=function(g){return arguments.length?(o=+g,f):o},f.tickSizeOuter=function(g){return arguments.length?(a=+g,f):a},f.tickPadding=function(g){return arguments.length?(s=+g,f):s},f.offset=function(g){return arguments.length?(u=+g,f):u},f}function Kn(t){return Re(_n,t)}function Zn(t){return Re(Ct,t)}var Fr={value:()=>{}};function Le(){for(var t=0,n=arguments.length,e={},r;t<n;++t){if(!(r=arguments[t]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new Xt(e)}function Xt(t){this._=t}function qr(t,n){return t.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");if(i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}Xt.prototype=Le.prototype={constructor:Xt,on:function(t,n){var e=this._,r=qr(t+"",e),i,o=-1,a=r.length;if(arguments.length<2){for(;++o<a;)if((i=(t=r[o]).type)&&(i=Wr(e[i],t.name)))return i;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++o<a;)if(i=(t=r[o]).type)e[i]=Qn(e[i],t.name,n);else if(n==null)for(i in e)e[i]=Qn(e[i],t.name,null);return this},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new Xt(t)},call:function(t,n){if((i=arguments.length-2)>0)for(var e=new Array(i),r=0,i,o;r<i;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(n,e)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(n,e)}};function Wr(t,n){for(var e=0,r=t.length,i;e<r;++e)if((i=t[e]).name===n)return i.value}function Qn(t,n,e){for(var r=0,i=t.length;r<i;++r)if(t[r].name===n){t[r]=Fr,t=t.slice(0,r).concat(t.slice(r+1));break}return e!=null&&t.push({name:n,value:e}),t}var bn="http://www.w3.org/1999/xhtml";const jn={svg:"http://www.w3.org/2000/svg",xhtml:bn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function sn(t){var n=t+="",e=n.indexOf(":");return e>=0&&(n=t.slice(0,e))!=="xmlns"&&(t=t.slice(e+1)),jn.hasOwnProperty(n)?{space:jn[n],local:t}:t}function Hr(t){return function(){var n=this.ownerDocument,e=this.namespaceURI;return e===bn&&n.documentElement.namespaceURI===bn?n.createElement(t):n.createElementNS(e,t)}}function Xr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Pe(t){var n=sn(t);return(n.local?Xr:Hr)(n)}function Yr(){}function Tn(t){return t==null?Yr:function(){return this.querySelector(t)}}function Gr(t){typeof t!="function"&&(t=Tn(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o=n[i],a=o.length,s=r[i]=new Array(a),u,l,c=0;c<a;++c)(u=o[c])&&(l=t.call(u,u.__data__,c,o))&&("__data__"in u&&(l.__data__=u.__data__),s[c]=l);return new U(r,this._parents)}function Ur(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Jr(){return[]}function Oe(t){return t==null?Jr:function(){return this.querySelectorAll(t)}}function Kr(t){return function(){return Ur(t.apply(this,arguments))}}function Zr(t){typeof t=="function"?t=Kr(t):t=Oe(t);for(var n=this._groups,e=n.length,r=[],i=[],o=0;o<e;++o)for(var a=n[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&(r.push(t.call(u,u.__data__,l,a)),i.push(u));return new U(r,i)}function ze(t){return function(){return this.matches(t)}}function Be(t){return function(n){return n.matches(t)}}var Qr=Array.prototype.find;function jr(t){return function(){return Qr.call(this.children,t)}}function ti(){return this.firstElementChild}function ni(t){return this.select(t==null?ti:jr(typeof t=="function"?t:Be(t)))}var ei=Array.prototype.filter;function ri(){return Array.from(this.children)}function ii(t){return function(){return ei.call(this.children,t)}}function oi(t){return this.selectAll(t==null?ri:ii(typeof t=="function"?t:Be(t)))}function ai(t){typeof t!="function"&&(t=ze(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o=n[i],a=o.length,s=r[i]=[],u,l=0;l<a;++l)(u=o[l])&&t.call(u,u.__data__,l,o)&&s.push(u);return new U(r,this._parents)}function Ve(t){return new Array(t.length)}function si(){return new U(this._enter||this._groups.map(Ve),this._parents)}function Kt(t,n){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=n}Kt.prototype={constructor:Kt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,n){return this._parent.insertBefore(t,n)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function li(t){return function(){return t}}function ui(t,n,e,r,i,o){for(var a=0,s,u=n.length,l=o.length;a<l;++a)(s=n[a])?(s.__data__=o[a],r[a]=s):e[a]=new Kt(t,o[a]);for(;a<u;++a)(s=n[a])&&(i[a]=s)}function ci(t,n,e,r,i,o,a){var s,u,l=new Map,c=n.length,h=o.length,f=new Array(c),g;for(s=0;s<c;++s)(u=n[s])&&(f[s]=g=a.call(u,u.__data__,s,n)+"",l.has(g)?i[s]=u:l.set(g,u));for(s=0;s<h;++s)g=a.call(t,o[s],s,o)+"",(u=l.get(g))?(r[s]=u,u.__data__=o[s],l.delete(g)):e[s]=new Kt(t,o[s]);for(s=0;s<c;++s)(u=n[s])&&l.get(f[s])===u&&(i[s]=u)}function fi(t){return t.__data__}function hi(t,n){if(!arguments.length)return Array.from(this,fi);var e=n?ci:ui,r=this._parents,i=this._groups;typeof t!="function"&&(t=li(t));for(var o=i.length,a=new Array(o),s=new Array(o),u=new Array(o),l=0;l<o;++l){var c=r[l],h=i[l],f=h.length,g=di(t.call(c,c&&c.__data__,l,r)),x=g.length,y=s[l]=new Array(x),b=a[l]=new Array(x),M=u[l]=new Array(f);e(c,h,y,b,M,g,n);for(var I=0,$=0,m,d;I<x;++I)if(m=y[I]){for(I>=$&&($=I+1);!(d=b[$])&&++$<x;);m._next=d||null}}return a=new U(a,r),a._enter=s,a._exit=u,a}function di(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function gi(){return new U(this._exit||this._groups.map(Ve),this._parents)}function pi(t,n,e){var r=this.enter(),i=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),n!=null&&(i=n(i),i&&(i=i.selection())),e==null?o.remove():e(o),r&&i?r.merge(i).order():i}function mi(t){for(var n=t.selection?t.selection():t,e=this._groups,r=n._groups,i=e.length,o=r.length,a=Math.min(i,o),s=new Array(i),u=0;u<a;++u)for(var l=e[u],c=r[u],h=l.length,f=s[u]=new Array(h),g,x=0;x<h;++x)(g=l[x]||c[x])&&(f[x]=g);for(;u<i;++u)s[u]=e[u];return new U(s,this._parents)}function yi(){for(var t=this._groups,n=-1,e=t.length;++n<e;)for(var r=t[n],i=r.length-1,o=r[i],a;--i>=0;)(a=r[i])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function xi(t){t||(t=vi);function n(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var e=this._groups,r=e.length,i=new Array(r),o=0;o<r;++o){for(var a=e[o],s=a.length,u=i[o]=new Array(s),l,c=0;c<s;++c)(l=a[c])&&(u[c]=l);u.sort(n)}return new U(i,this._parents).order()}function vi(t,n){return t<n?-1:t>n?1:t>=n?0:NaN}function wi(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function _i(){return Array.from(this)}function bi(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null}function Mi(){let t=0;for(const n of this)++t;return t}function ki(){return!this.node()}function $i(t){for(var n=this._groups,e=0,r=n.length;e<r;++e)for(var i=n[e],o=0,a=i.length,s;o<a;++o)(s=i[o])&&t.call(s,s.__data__,o,i);return this}function Ai(t){return function(){this.removeAttribute(t)}}function Ci(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ni(t,n){return function(){this.setAttribute(t,n)}}function Si(t,n){return function(){this.setAttributeNS(t.space,t.local,n)}}function Ei(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttribute(t):this.setAttribute(t,e)}}function Ii(t,n){return function(){var e=n.apply(this,arguments);e==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,e)}}function Ti(t,n){var e=sn(t);if(arguments.length<2){var r=this.node();return e.local?r.getAttributeNS(e.space,e.local):r.getAttribute(e)}return this.each((n==null?e.local?Ci:Ai:typeof n=="function"?e.local?Ii:Ei:e.local?Si:Ni)(e,n))}function De(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ri(t){return function(){this.style.removeProperty(t)}}function Li(t,n,e){return function(){this.style.setProperty(t,n,e)}}function Pi(t,n,e){return function(){var r=n.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,e)}}function Oi(t,n,e){return arguments.length>1?this.each((n==null?Ri:typeof n=="function"?Pi:Li)(t,n,e??"")):bt(this.node(),t)}function bt(t,n){return t.style.getPropertyValue(n)||De(t).getComputedStyle(t,null).getPropertyValue(n)}function zi(t){return function(){delete this[t]}}function Bi(t,n){return function(){this[t]=n}}function Vi(t,n){return function(){var e=n.apply(this,arguments);e==null?delete this[t]:this[t]=e}}function Di(t,n){return arguments.length>1?this.each((n==null?zi:typeof n=="function"?Vi:Bi)(t,n)):this.node()[t]}function Fe(t){return t.trim().split(/^|\s+/)}function Rn(t){return t.classList||new qe(t)}function qe(t){this._node=t,this._names=Fe(t.getAttribute("class")||"")}qe.prototype={add:function(t){var n=this._names.indexOf(t);n<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var n=this._names.indexOf(t);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function We(t,n){for(var e=Rn(t),r=-1,i=n.length;++r<i;)e.add(n[r])}function He(t,n){for(var e=Rn(t),r=-1,i=n.length;++r<i;)e.remove(n[r])}function Fi(t){return function(){We(this,t)}}function qi(t){return function(){He(this,t)}}function Wi(t,n){return function(){(n.apply(this,arguments)?We:He)(this,t)}}function Hi(t,n){var e=Fe(t+"");if(arguments.length<2){for(var r=Rn(this.node()),i=-1,o=e.length;++i<o;)if(!r.contains(e[i]))return!1;return!0}return this.each((typeof n=="function"?Wi:n?Fi:qi)(e,n))}function Xi(){this.textContent=""}function Yi(t){return function(){this.textContent=t}}function Gi(t){return function(){var n=t.apply(this,arguments);this.textContent=n??""}}function Ui(t){return arguments.length?this.each(t==null?Xi:(typeof t=="function"?Gi:Yi)(t)):this.node().textContent}function Ji(){this.innerHTML=""}function Ki(t){return function(){this.innerHTML=t}}function Zi(t){return function(){var n=t.apply(this,arguments);this.innerHTML=n??""}}function Qi(t){return arguments.length?this.each(t==null?Ji:(typeof t=="function"?Zi:Ki)(t)):this.node().innerHTML}function ji(){this.nextSibling&&this.parentNode.appendChild(this)}function to(){return this.each(ji)}function no(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function eo(){return this.each(no)}function ro(t){var n=typeof t=="function"?t:Pe(t);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function io(){return null}function oo(t,n){var e=typeof t=="function"?t:Pe(t),r=n==null?io:typeof n=="function"?n:Tn(n);return this.select(function(){return this.insertBefore(e.apply(this,arguments),r.apply(this,arguments)||null)})}function ao(){var t=this.parentNode;t&&t.removeChild(this)}function so(){return this.each(ao)}function lo(){var t=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function uo(){var t=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(t,this.nextSibling):t}function co(t){return this.select(t?uo:lo)}function fo(t){return arguments.length?this.property("__data__",t):this.node().__data__}function ho(t){return function(n){t.call(this,n,this.__data__)}}function go(t){return t.trim().split(/^|\s+/).map(function(n){var e="",r=n.indexOf(".");return r>=0&&(e=n.slice(r+1),n=n.slice(0,r)),{type:n,name:e}})}function po(t){return function(){var n=this.__on;if(n){for(var e=0,r=-1,i=n.length,o;e<i;++e)o=n[e],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):n[++r]=o;++r?n.length=r:delete this.__on}}}function mo(t,n,e){return function(){var r=this.__on,i,o=ho(n);if(r){for(var a=0,s=r.length;a<s;++a)if((i=r[a]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=e),i.value=n;return}}this.addEventListener(t.type,o,e),i={type:t.type,name:t.name,value:n,listener:o,options:e},r?r.push(i):this.__on=[i]}}function yo(t,n,e){var r=go(t+""),i,o=r.length,a;if(arguments.length<2){var s=this.node().__on;if(s){for(var u=0,l=s.length,c;u<l;++u)for(i=0,c=s[u];i<o;++i)if((a=r[i]).type===c.type&&a.name===c.name)return c.value}return}for(s=n?mo:po,i=0;i<o;++i)this.each(s(r[i],n,e));return this}function Xe(t,n,e){var r=De(t),i=r.CustomEvent;typeof i=="function"?i=new i(n,e):(i=r.document.createEvent("Event"),e?(i.initEvent(n,e.bubbles,e.cancelable),i.detail=e.detail):i.initEvent(n,!1,!1)),t.dispatchEvent(i)}function xo(t,n){return function(){return Xe(this,t,n)}}function vo(t,n){return function(){return Xe(this,t,n.apply(this,arguments))}}function wo(t,n){return this.each((typeof n=="function"?vo:xo)(t,n))}function*_o(){for(var t=this._groups,n=0,e=t.length;n<e;++n)for(var r=t[n],i=0,o=r.length,a;i<o;++i)(a=r[i])&&(yield a)}var Ye=[null];function U(t,n){this._groups=t,this._parents=n}function Pt(){return new U([[document.documentElement]],Ye)}function bo(){return this}U.prototype=Pt.prototype={constructor:U,select:Gr,selectAll:Zr,selectChild:ni,selectChildren:oi,filter:ai,data:hi,enter:si,exit:gi,join:pi,merge:mi,selection:bo,order:yi,sort:xi,call:wi,nodes:_i,node:bi,size:Mi,empty:ki,each:$i,attr:Ti,style:Oi,property:Di,classed:Hi,text:Ui,html:Qi,raise:to,lower:eo,append:ro,insert:oo,remove:so,clone:co,datum:fo,on:yo,dispatch:wo,[Symbol.iterator]:_o};function gt(t){return typeof t=="string"?new U([[document.querySelector(t)]],[document.documentElement]):new U([[t]],Ye)}function Ln(t,n,e){t.prototype=n.prototype=e,e.constructor=t}function Ge(t,n){var e=Object.create(t.prototype);for(var r in n)e[r]=n[r];return e}function Ot(){}var It=.7,Zt=1/It,_t="\\s*([+-]?\\d+)\\s*",Tt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Mo=/^#([0-9a-f]{3,8})$/,ko=new RegExp(`^rgb\\(${_t},${_t},${_t}\\)$`),$o=new RegExp(`^rgb\\(${ot},${ot},${ot}\\)$`),Ao=new RegExp(`^rgba\\(${_t},${_t},${_t},${Tt}\\)$`),Co=new RegExp(`^rgba\\(${ot},${ot},${ot},${Tt}\\)$`),No=new RegExp(`^hsl\\(${Tt},${ot},${ot}\\)$`),So=new RegExp(`^hsla\\(${Tt},${ot},${ot},${Tt}\\)$`),te={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ln(Ot,mt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:ne,formatHex:ne,formatHex8:Eo,formatHsl:Io,formatRgb:ee,toString:ee});function ne(){return this.rgb().formatHex()}function Eo(){return this.rgb().formatHex8()}function Io(){return Ue(this).formatHsl()}function ee(){return this.rgb().formatRgb()}function mt(t){var n,e;return t=(t+"").trim().toLowerCase(),(n=Mo.exec(t))?(e=n[1].length,n=parseInt(n[1],16),e===6?re(n):e===3?new Y(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):e===8?Bt(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):e===4?Bt(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=ko.exec(t))?new Y(n[1],n[2],n[3],1):(n=$o.exec(t))?new Y(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=Ao.exec(t))?Bt(n[1],n[2],n[3],n[4]):(n=Co.exec(t))?Bt(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=No.exec(t))?ae(n[1],n[2]/100,n[3]/100,1):(n=So.exec(t))?ae(n[1],n[2]/100,n[3]/100,n[4]):te.hasOwnProperty(t)?re(te[t]):t==="transparent"?new Y(NaN,NaN,NaN,0):null}function re(t){return new Y(t>>16&255,t>>8&255,t&255,1)}function Bt(t,n,e,r){return r<=0&&(t=n=e=NaN),new Y(t,n,e,r)}function To(t){return t instanceof Ot||(t=mt(t)),t?(t=t.rgb(),new Y(t.r,t.g,t.b,t.opacity)):new Y}function Mn(t,n,e,r){return arguments.length===1?To(t):new Y(t,n,e,r??1)}function Y(t,n,e,r){this.r=+t,this.g=+n,this.b=+e,this.opacity=+r}Ln(Y,Mn,Ge(Ot,{brighter(t){return t=t==null?Zt:Math.pow(Zt,t),new Y(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?It:Math.pow(It,t),new Y(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Y(pt(this.r),pt(this.g),pt(this.b),Qt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ie,formatHex:ie,formatHex8:Ro,formatRgb:oe,toString:oe}));function ie(){return`#${dt(this.r)}${dt(this.g)}${dt(this.b)}`}function Ro(){return`#${dt(this.r)}${dt(this.g)}${dt(this.b)}${dt((isNaN(this.opacity)?1:this.opacity)*255)}`}function oe(){const t=Qt(this.opacity);return`${t===1?"rgb(":"rgba("}${pt(this.r)}, ${pt(this.g)}, ${pt(this.b)}${t===1?")":`, ${t})`}`}function Qt(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function pt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function dt(t){return t=pt(t),(t<16?"0":"")+t.toString(16)}function ae(t,n,e,r){return r<=0?t=n=e=NaN:e<=0||e>=1?t=n=NaN:n<=0&&(t=NaN),new nt(t,n,e,r)}function Ue(t){if(t instanceof nt)return new nt(t.h,t.s,t.l,t.opacity);if(t instanceof Ot||(t=mt(t)),!t)return new nt;if(t instanceof nt)return t;t=t.rgb();var n=t.r/255,e=t.g/255,r=t.b/255,i=Math.min(n,e,r),o=Math.max(n,e,r),a=NaN,s=o-i,u=(o+i)/2;return s?(n===o?a=(e-r)/s+(e<r)*6:e===o?a=(r-n)/s+2:a=(n-e)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new nt(a,s,u,t.opacity)}function Lo(t,n,e,r){return arguments.length===1?Ue(t):new nt(t,n,e,r??1)}function nt(t,n,e,r){this.h=+t,this.s=+n,this.l=+e,this.opacity=+r}Ln(nt,Lo,Ge(Ot,{brighter(t){return t=t==null?Zt:Math.pow(Zt,t),new nt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?It:Math.pow(It,t),new nt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,n=isNaN(t)||isNaN(this.s)?0:this.s,e=this.l,r=e+(e<.5?e:1-e)*n,i=2*e-r;return new Y(pn(t>=240?t-240:t+120,i,r),pn(t,i,r),pn(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new nt(se(this.h),Vt(this.s),Vt(this.l),Qt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Qt(this.opacity);return`${t===1?"hsl(":"hsla("}${se(this.h)}, ${Vt(this.s)*100}%, ${Vt(this.l)*100}%${t===1?")":`, ${t})`}`}}));function se(t){return t=(t||0)%360,t<0?t+360:t}function Vt(t){return Math.max(0,Math.min(1,t||0))}function pn(t,n,e){return(t<60?n+(e-n)*t/60:t<180?e:t<240?n+(e-n)*(240-t)/60:n)*255}const Pn=t=>()=>t;function Po(t,n){return function(e){return t+e*n}}function Oo(t,n,e){return t=Math.pow(t,e),n=Math.pow(n,e)-t,e=1/e,function(r){return Math.pow(t+r*n,e)}}function zo(t){return(t=+t)==1?Je:function(n,e){return e-n?Oo(n,e,t):Pn(isNaN(n)?e:n)}}function Je(t,n){var e=n-t;return e?Po(t,e):Pn(isNaN(t)?n:t)}const jt=function t(n){var e=zo(n);function r(i,o){var a=e((i=Mn(i)).r,(o=Mn(o)).r),s=e(i.g,o.g),u=e(i.b,o.b),l=Je(i.opacity,o.opacity);return function(c){return i.r=a(c),i.g=s(c),i.b=u(c),i.opacity=l(c),i+""}}return r.gamma=t,r}(1);function Bo(t,n){n||(n=[]);var e=t?Math.min(n.length,t.length):0,r=n.slice(),i;return function(o){for(i=0;i<e;++i)r[i]=t[i]*(1-o)+n[i]*o;return r}}function Vo(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Do(t,n){var e=n?n.length:0,r=t?Math.min(e,t.length):0,i=new Array(r),o=new Array(e),a;for(a=0;a<r;++a)i[a]=On(t[a],n[a]);for(;a<e;++a)o[a]=n[a];return function(s){for(a=0;a<r;++a)o[a]=i[a](s);return o}}function Fo(t,n){var e=new Date;return t=+t,n=+n,function(r){return e.setTime(t*(1-r)+n*r),e}}function tt(t,n){return t=+t,n=+n,function(e){return t*(1-e)+n*e}}function qo(t,n){var e={},r={},i;(t===null||typeof t!="object")&&(t={}),(n===null||typeof n!="object")&&(n={});for(i in n)i in t?e[i]=On(t[i],n[i]):r[i]=n[i];return function(o){for(i in e)r[i]=e[i](o);return r}}var kn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,mn=new RegExp(kn.source,"g");function Wo(t){return function(){return t}}function Ho(t){return function(n){return t(n)+""}}function Ke(t,n){var e=kn.lastIndex=mn.lastIndex=0,r,i,o,a=-1,s=[],u=[];for(t=t+"",n=n+"";(r=kn.exec(t))&&(i=mn.exec(n));)(o=i.index)>e&&(o=n.slice(e,o),s[a]?s[a]+=o:s[++a]=o),(r=r[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,u.push({i:a,x:tt(r,i)})),e=mn.lastIndex;return e<n.length&&(o=n.slice(e),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?Ho(u[0].x):Wo(n):(n=u.length,function(l){for(var c=0,h;c<n;++c)s[(h=u[c]).i]=h.x(l);return s.join("")})}function On(t,n){var e=typeof n,r;return n==null||e==="boolean"?Pn(n):(e==="number"?tt:e==="string"?(r=mt(n))?(n=r,jt):Ke:n instanceof mt?jt:n instanceof Date?Fo:Vo(n)?Bo:Array.isArray(n)?Do:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?qo:tt)(t,n)}function Xo(t,n){return t=+t,n=+n,function(e){return Math.round(t*(1-e)+n*e)}}var le=180/Math.PI,$n={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ze(t,n,e,r,i,o){var a,s,u;return(a=Math.sqrt(t*t+n*n))&&(t/=a,n/=a),(u=t*e+n*r)&&(e-=t*u,r-=n*u),(s=Math.sqrt(e*e+r*r))&&(e/=s,r/=s,u/=s),t*r<n*e&&(t=-t,n=-n,u=-u,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(n,t)*le,skewX:Math.atan(u)*le,scaleX:a,scaleY:s}}var Dt;function Yo(t){const n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return n.isIdentity?$n:Ze(n.a,n.b,n.c,n.d,n.e,n.f)}function Go(t){return t==null||(Dt||(Dt=document.createElementNS("http://www.w3.org/2000/svg","g")),Dt.setAttribute("transform",t),!(t=Dt.transform.baseVal.consolidate()))?$n:(t=t.matrix,Ze(t.a,t.b,t.c,t.d,t.e,t.f))}function Qe(t,n,e,r){function i(l){return l.length?l.pop()+" ":""}function o(l,c,h,f,g,x){if(l!==h||c!==f){var y=g.push("translate(",null,n,null,e);x.push({i:y-4,x:tt(l,h)},{i:y-2,x:tt(c,f)})}else(h||f)&&g.push("translate("+h+n+f+e)}function a(l,c,h,f){l!==c?(l-c>180?c+=360:c-l>180&&(l+=360),f.push({i:h.push(i(h)+"rotate(",null,r)-2,x:tt(l,c)})):c&&h.push(i(h)+"rotate("+c+r)}function s(l,c,h,f){l!==c?f.push({i:h.push(i(h)+"skewX(",null,r)-2,x:tt(l,c)}):c&&h.push(i(h)+"skewX("+c+r)}function u(l,c,h,f,g,x){if(l!==h||c!==f){var y=g.push(i(g)+"scale(",null,",",null,")");x.push({i:y-4,x:tt(l,h)},{i:y-2,x:tt(c,f)})}else(h!==1||f!==1)&&g.push(i(g)+"scale("+h+","+f+")")}return function(l,c){var h=[],f=[];return l=t(l),c=t(c),o(l.translateX,l.translateY,c.translateX,c.translateY,h,f),a(l.rotate,c.rotate,h,f),s(l.skewX,c.skewX,h,f),u(l.scaleX,l.scaleY,c.scaleX,c.scaleY,h,f),l=c=null,function(g){for(var x=-1,y=f.length,b;++x<y;)h[(b=f[x]).i]=b.x(g);return h.join("")}}}var Uo=Qe(Yo,"px, ","px)","deg)"),Jo=Qe(Go,", ",")",")"),Mt=0,Nt=0,At=0,je=1e3,tn,St,nn=0,yt=0,ln=0,Rt=typeof performance=="object"&&performance.now?performance:Date,tr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function zn(){return yt||(tr(Ko),yt=Rt.now()+ln)}function Ko(){yt=0}function en(){this._call=this._time=this._next=null}en.prototype=nr.prototype={constructor:en,restart:function(t,n,e){if(typeof t!="function")throw new TypeError("callback is not a function");e=(e==null?zn():+e)+(n==null?0:+n),!this._next&&St!==this&&(St?St._next=this:tn=this,St=this),this._call=t,this._time=e,An()},stop:function(){this._call&&(this._call=null,this._time=1/0,An())}};function nr(t,n,e){var r=new en;return r.restart(t,n,e),r}function Zo(){zn(),++Mt;for(var t=tn,n;t;)(n=yt-t._time)>=0&&t._call.call(void 0,n),t=t._next;--Mt}function ue(){yt=(nn=Rt.now())+ln,Mt=Nt=0;try{Zo()}finally{Mt=0,jo(),yt=0}}function Qo(){var t=Rt.now(),n=t-nn;n>je&&(ln-=n,nn=t)}function jo(){for(var t,n=tn,e,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:tn=e);St=t,An(r)}function An(t){if(!Mt){Nt&&(Nt=clearTimeout(Nt));var n=t-yt;n>24?(t<1/0&&(Nt=setTimeout(ue,t-Rt.now()-ln)),At&&(At=clearInterval(At))):(At||(nn=Rt.now(),At=setInterval(Qo,je)),Mt=1,tr(ue))}}function ce(t,n,e){var r=new en;return n=n==null?0:+n,r.restart(i=>{r.stop(),t(i+n)},n,e),r}var ta=Le("start","end","cancel","interrupt"),na=[],er=0,fe=1,Cn=2,Yt=3,he=4,Nn=5,Gt=6;function un(t,n,e,r,i,o){var a=t.__transition;if(!a)t.__transition={};else if(e in a)return;ea(t,e,{name:n,index:r,group:i,on:ta,tween:na,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:er})}function Bn(t,n){var e=et(t,n);if(e.state>er)throw new Error("too late; already scheduled");return e}function at(t,n){var e=et(t,n);if(e.state>Yt)throw new Error("too late; already running");return e}function et(t,n){var e=t.__transition;if(!e||!(e=e[n]))throw new Error("transition not found");return e}function ea(t,n,e){var r=t.__transition,i;r[n]=e,e.timer=nr(o,0,e.time);function o(l){e.state=fe,e.timer.restart(a,e.delay,e.time),e.delay<=l&&a(l-e.delay)}function a(l){var c,h,f,g;if(e.state!==fe)return u();for(c in r)if(g=r[c],g.name===e.name){if(g.state===Yt)return ce(a);g.state===he?(g.state=Gt,g.timer.stop(),g.on.call("interrupt",t,t.__data__,g.index,g.group),delete r[c]):+c<n&&(g.state=Gt,g.timer.stop(),g.on.call("cancel",t,t.__data__,g.index,g.group),delete r[c])}if(ce(function(){e.state===Yt&&(e.state=he,e.timer.restart(s,e.delay,e.time),s(l))}),e.state=Cn,e.on.call("start",t,t.__data__,e.index,e.group),e.state===Cn){for(e.state=Yt,i=new Array(f=e.tween.length),c=0,h=-1;c<f;++c)(g=e.tween[c].value.call(t,t.__data__,e.index,e.group))&&(i[++h]=g);i.length=h+1}}function s(l){for(var c=l<e.duration?e.ease.call(null,l/e.duration):(e.timer.restart(u),e.state=Nn,1),h=-1,f=i.length;++h<f;)i[h].call(t,c);e.state===Nn&&(e.on.call("end",t,t.__data__,e.index,e.group),u())}function u(){e.state=Gt,e.timer.stop(),delete r[n];for(var l in r)return;delete t.__transition}}function ra(t,n){var e=t.__transition,r,i,o=!0,a;if(e){n=n==null?null:n+"";for(a in e){if((r=e[a]).name!==n){o=!1;continue}i=r.state>Cn&&r.state<Nn,r.state=Gt,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete e[a]}o&&delete t.__transition}}function ia(t){return this.each(function(){ra(this,t)})}function oa(t,n){var e,r;return function(){var i=at(this,t),o=i.tween;if(o!==e){r=e=o;for(var a=0,s=r.length;a<s;++a)if(r[a].name===n){r=r.slice(),r.splice(a,1);break}}i.tween=r}}function aa(t,n,e){var r,i;if(typeof e!="function")throw new Error;return function(){var o=at(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var s={name:n,value:e},u=0,l=i.length;u<l;++u)if(i[u].name===n){i[u]=s;break}u===l&&i.push(s)}o.tween=i}}function sa(t,n){var e=this._id;if(t+="",arguments.length<2){for(var r=et(this.node(),e).tween,i=0,o=r.length,a;i<o;++i)if((a=r[i]).name===t)return a.value;return null}return this.each((n==null?oa:aa)(e,t,n))}function Vn(t,n,e){var r=t._id;return t.each(function(){var i=at(this,r);(i.value||(i.value={}))[n]=e.apply(this,arguments)}),function(i){return et(i,r).value[n]}}function rr(t,n){var e;return(typeof n=="number"?tt:n instanceof mt?jt:(e=mt(n))?(n=e,jt):Ke)(t,n)}function la(t){return function(){this.removeAttribute(t)}}function ua(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ca(t,n,e){var r,i=e+"",o;return function(){var a=this.getAttribute(t);return a===i?null:a===r?o:o=n(r=a,e)}}function fa(t,n,e){var r,i=e+"",o;return function(){var a=this.getAttributeNS(t.space,t.local);return a===i?null:a===r?o:o=n(r=a,e)}}function ha(t,n,e){var r,i,o;return function(){var a,s=e(this),u;return s==null?void this.removeAttribute(t):(a=this.getAttribute(t),u=s+"",a===u?null:a===r&&u===i?o:(i=u,o=n(r=a,s)))}}function da(t,n,e){var r,i,o;return function(){var a,s=e(this),u;return s==null?void this.removeAttributeNS(t.space,t.local):(a=this.getAttributeNS(t.space,t.local),u=s+"",a===u?null:a===r&&u===i?o:(i=u,o=n(r=a,s)))}}function ga(t,n){var e=sn(t),r=e==="transform"?Jo:rr;return this.attrTween(t,typeof n=="function"?(e.local?da:ha)(e,r,Vn(this,"attr."+t,n)):n==null?(e.local?ua:la)(e):(e.local?fa:ca)(e,r,n))}function pa(t,n){return function(e){this.setAttribute(t,n.call(this,e))}}function ma(t,n){return function(e){this.setAttributeNS(t.space,t.local,n.call(this,e))}}function ya(t,n){var e,r;function i(){var o=n.apply(this,arguments);return o!==r&&(e=(r=o)&&ma(t,o)),e}return i._value=n,i}function xa(t,n){var e,r;function i(){var o=n.apply(this,arguments);return o!==r&&(e=(r=o)&&pa(t,o)),e}return i._value=n,i}function va(t,n){var e="attr."+t;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;var r=sn(t);return this.tween(e,(r.local?ya:xa)(r,n))}function wa(t,n){return function(){Bn(this,t).delay=+n.apply(this,arguments)}}function _a(t,n){return n=+n,function(){Bn(this,t).delay=n}}function ba(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?wa:_a)(n,t)):et(this.node(),n).delay}function Ma(t,n){return function(){at(this,t).duration=+n.apply(this,arguments)}}function ka(t,n){return n=+n,function(){at(this,t).duration=n}}function $a(t){var n=this._id;return arguments.length?this.each((typeof t=="function"?Ma:ka)(n,t)):et(this.node(),n).duration}function Aa(t,n){if(typeof n!="function")throw new Error;return function(){at(this,t).ease=n}}function Ca(t){var n=this._id;return arguments.length?this.each(Aa(n,t)):et(this.node(),n).ease}function Na(t,n){return function(){var e=n.apply(this,arguments);if(typeof e!="function")throw new Error;at(this,t).ease=e}}function Sa(t){if(typeof t!="function")throw new Error;return this.each(Na(this._id,t))}function Ea(t){typeof t!="function"&&(t=ze(t));for(var n=this._groups,e=n.length,r=new Array(e),i=0;i<e;++i)for(var o=n[i],a=o.length,s=r[i]=[],u,l=0;l<a;++l)(u=o[l])&&t.call(u,u.__data__,l,o)&&s.push(u);return new ut(r,this._parents,this._name,this._id)}function Ia(t){if(t._id!==this._id)throw new Error;for(var n=this._groups,e=t._groups,r=n.length,i=e.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var u=n[s],l=e[s],c=u.length,h=a[s]=new Array(c),f,g=0;g<c;++g)(f=u[g]||l[g])&&(h[g]=f);for(;s<r;++s)a[s]=n[s];return new ut(a,this._parents,this._name,this._id)}function Ta(t){return(t+"").trim().split(/^|\s+/).every(function(n){var e=n.indexOf(".");return e>=0&&(n=n.slice(0,e)),!n||n==="start"})}function Ra(t,n,e){var r,i,o=Ta(n)?Bn:at;return function(){var a=o(this,t),s=a.on;s!==r&&(i=(r=s).copy()).on(n,e),a.on=i}}function La(t,n){var e=this._id;return arguments.length<2?et(this.node(),e).on.on(t):this.each(Ra(e,t,n))}function Pa(t){return function(){var n=this.parentNode;for(var e in this.__transition)if(+e!==t)return;n&&n.removeChild(this)}}function Oa(){return this.on("end.remove",Pa(this._id))}function za(t){var n=this._name,e=this._id;typeof t!="function"&&(t=Tn(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var s=r[a],u=s.length,l=o[a]=new Array(u),c,h,f=0;f<u;++f)(c=s[f])&&(h=t.call(c,c.__data__,f,s))&&("__data__"in c&&(h.__data__=c.__data__),l[f]=h,un(l[f],n,e,f,l,et(c,e)));return new ut(o,this._parents,n,e)}function Ba(t){var n=this._name,e=this._id;typeof t!="function"&&(t=Oe(t));for(var r=this._groups,i=r.length,o=[],a=[],s=0;s<i;++s)for(var u=r[s],l=u.length,c,h=0;h<l;++h)if(c=u[h]){for(var f=t.call(c,c.__data__,h,u),g,x=et(c,e),y=0,b=f.length;y<b;++y)(g=f[y])&&un(g,n,e,y,f,x);o.push(f),a.push(c)}return new ut(o,a,n,e)}var Va=Pt.prototype.constructor;function Da(){return new Va(this._groups,this._parents)}function Fa(t,n){var e,r,i;return function(){var o=bt(this,t),a=(this.style.removeProperty(t),bt(this,t));return o===a?null:o===e&&a===r?i:i=n(e=o,r=a)}}function ir(t){return function(){this.style.removeProperty(t)}}function qa(t,n,e){var r,i=e+"",o;return function(){var a=bt(this,t);return a===i?null:a===r?o:o=n(r=a,e)}}function Wa(t,n,e){var r,i,o;return function(){var a=bt(this,t),s=e(this),u=s+"";return s==null&&(u=s=(this.style.removeProperty(t),bt(this,t))),a===u?null:a===r&&u===i?o:(i=u,o=n(r=a,s))}}function Ha(t,n){var e,r,i,o="style."+n,a="end."+o,s;return function(){var u=at(this,t),l=u.on,c=u.value[o]==null?s||(s=ir(n)):void 0;(l!==e||i!==c)&&(r=(e=l).copy()).on(a,i=c),u.on=r}}function Xa(t,n,e){var r=(t+="")=="transform"?Uo:rr;return n==null?this.styleTween(t,Fa(t,r)).on("end.style."+t,ir(t)):typeof n=="function"?this.styleTween(t,Wa(t,r,Vn(this,"style."+t,n))).each(Ha(this._id,t)):this.styleTween(t,qa(t,r,n),e).on("end.style."+t,null)}function Ya(t,n,e){return function(r){this.style.setProperty(t,n.call(this,r),e)}}function Ga(t,n,e){var r,i;function o(){var a=n.apply(this,arguments);return a!==i&&(r=(i=a)&&Ya(t,a,e)),r}return o._value=n,o}function Ua(t,n,e){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(n==null)return this.tween(r,null);if(typeof n!="function")throw new Error;return this.tween(r,Ga(t,n,e??""))}function Ja(t){return function(){this.textContent=t}}function Ka(t){return function(){var n=t(this);this.textContent=n??""}}function Za(t){return this.tween("text",typeof t=="function"?Ka(Vn(this,"text",t)):Ja(t==null?"":t+""))}function Qa(t){return function(n){this.textContent=t.call(this,n)}}function ja(t){var n,e;function r(){var i=t.apply(this,arguments);return i!==e&&(n=(e=i)&&Qa(i)),n}return r._value=t,r}function ts(t){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;return this.tween(n,ja(t))}function ns(){for(var t=this._name,n=this._id,e=or(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],s=a.length,u,l=0;l<s;++l)if(u=a[l]){var c=et(u,n);un(u,t,e,l,a,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new ut(r,this._parents,t,e)}function es(){var t,n,e=this,r=e._id,i=e.size();return new Promise(function(o,a){var s={value:a},u={value:function(){--i===0&&o()}};e.each(function(){var l=at(this,r),c=l.on;c!==t&&(n=(t=c).copy(),n._.cancel.push(s),n._.interrupt.push(s),n._.end.push(u)),l.on=n}),i===0&&o()})}var rs=0;function ut(t,n,e,r){this._groups=t,this._parents=n,this._name=e,this._id=r}function or(){return++rs}var st=Pt.prototype;ut.prototype={constructor:ut,select:za,selectAll:Ba,selectChild:st.selectChild,selectChildren:st.selectChildren,filter:Ea,merge:Ia,selection:Da,transition:ns,call:st.call,nodes:st.nodes,node:st.node,size:st.size,empty:st.empty,each:st.each,on:La,attr:ga,attrTween:va,style:Xa,styleTween:Ua,text:Za,textTween:ts,remove:Oa,tween:sa,delay:ba,duration:$a,ease:Ca,easeVarying:Sa,end:es,[Symbol.iterator]:st[Symbol.iterator]};function is(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var os={time:null,delay:0,duration:250,ease:is};function as(t,n){for(var e;!(e=t.__transition)||!(e=e[n]);)if(!(t=t.parentNode))throw new Error(`transition ${n} not found`);return e}function ss(t){var n,e;t instanceof ut?(n=t._id,t=t._name):(n=or(),(e=os).time=zn(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a=r[o],s=a.length,u,l=0;l<s;++l)(u=a[l])&&un(u,t,n,l,a,e||as(u,n));return new ut(r,this._parents,t,n)}Pt.prototype.interrupt=ia;Pt.prototype.transition=ss;const Sn=Math.PI,En=2*Sn,ht=1e-6,ls=En-ht;function ar(t){this._+=t[0];for(let n=1,e=t.length;n<e;++n)this._+=arguments[n]+t[n]}function us(t){let n=Math.floor(t);if(!(n>=0))throw new Error(`invalid digits: ${t}`);if(n>15)return ar;const e=10**n;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*e)/e+r[i]}}class cs{constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?ar:us(n)}moveTo(n,e){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,e){this._append`L${this._x1=+n},${this._y1=+e}`}quadraticCurveTo(n,e,r,i){this._append`Q${+n},${+e},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(n,e,r,i,o,a){this._append`C${+n},${+e},${+r},${+i},${this._x1=+o},${this._y1=+a}`}arcTo(n,e,r,i,o){if(n=+n,e=+e,r=+r,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let a=this._x1,s=this._y1,u=r-n,l=i-e,c=a-n,h=s-e,f=c*c+h*h;if(this._x1===null)this._append`M${this._x1=n},${this._y1=e}`;else if(f>ht)if(!(Math.abs(h*u-l*c)>ht)||!o)this._append`L${this._x1=n},${this._y1=e}`;else{let g=r-a,x=i-s,y=u*u+l*l,b=g*g+x*x,M=Math.sqrt(y),I=Math.sqrt(f),$=o*Math.tan((Sn-Math.acos((y+f-b)/(2*M*I)))/2),m=$/I,d=$/M;Math.abs(m-1)>ht&&this._append`L${n+m*c},${e+m*h}`,this._append`A${o},${o},0,0,${+(h*g>c*x)},${this._x1=n+d*u},${this._y1=e+d*l}`}}arc(n,e,r,i,o,a){if(n=+n,e=+e,r=+r,a=!!a,r<0)throw new Error(`negative radius: ${r}`);let s=r*Math.cos(i),u=r*Math.sin(i),l=n+s,c=e+u,h=1^a,f=a?i-o:o-i;this._x1===null?this._append`M${l},${c}`:(Math.abs(this._x1-l)>ht||Math.abs(this._y1-c)>ht)&&this._append`L${l},${c}`,r&&(f<0&&(f=f%En+En),f>ls?this._append`A${r},${r},0,1,${h},${n-s},${e-u}A${r},${r},0,1,${h},${this._x1=l},${this._y1=c}`:f>ht&&this._append`A${r},${r},0,${+(f>=Sn)},${h},${this._x1=n+r*Math.cos(o)},${this._y1=e+r*Math.sin(o)}`)}rect(n,e,r,i){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+e}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function fs(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(!(t.status===204||t.status===205))return t.json()}function Ft(t,n){return fetch(t,n).then(fs)}function hs(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function rn(t,n){if((e=(t=n?t.toExponential(n-1):t.toExponential()).indexOf("e"))<0)return null;var e,r=t.slice(0,e);return[r.length>1?r[0]+r.slice(2):r,+t.slice(e+1)]}function kt(t){return t=rn(Math.abs(t)),t?t[1]:NaN}function ds(t,n){return function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}}function gs(t){return function(n){return n.replace(/[0-9]/g,function(e){return t[+e]})}}var ps=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function on(t){if(!(n=ps.exec(t)))throw new Error("invalid format: "+t);var n;return new Dn({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}on.prototype=Dn.prototype;function Dn(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Dn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ms(t){t:for(var n=t.length,e=1,r=-1,i;e<n;++e)switch(t[e]){case".":r=i=e;break;case"0":r===0&&(r=e),i=e;break;default:if(!+t[e])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var sr;function ys(t,n){var e=rn(t,n);if(!e)return t+"";var r=e[0],i=e[1],o=i-(sr=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+rn(t,Math.max(0,n+o-1))[0]}function de(t,n){var e=rn(t,n);if(!e)return t+"";var r=e[0],i=e[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const ge={"%":(t,n)=>(t*100).toFixed(n),b:t=>Math.round(t).toString(2),c:t=>t+"",d:hs,e:(t,n)=>t.toExponential(n),f:(t,n)=>t.toFixed(n),g:(t,n)=>t.toPrecision(n),o:t=>Math.round(t).toString(8),p:(t,n)=>de(t*100,n),r:de,s:ys,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function pe(t){return t}var me=Array.prototype.map,ye=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function xs(t){var n=t.grouping===void 0||t.thousands===void 0?pe:ds(me.call(t.grouping,Number),t.thousands+""),e=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?pe:gs(me.call(t.numerals,String)),a=t.percent===void 0?"%":t.percent+"",s=t.minus===void 0?"−":t.minus+"",u=t.nan===void 0?"NaN":t.nan+"";function l(h){h=on(h);var f=h.fill,g=h.align,x=h.sign,y=h.symbol,b=h.zero,M=h.width,I=h.comma,$=h.precision,m=h.trim,d=h.type;d==="n"?(I=!0,d="g"):ge[d]||($===void 0&&($=12),m=!0,d="g"),(b||f==="0"&&g==="=")&&(b=!0,f="0",g="=");var p=y==="$"?e:y==="#"&&/[boxX]/.test(d)?"0"+d.toLowerCase():"",_=y==="$"?r:/[%p]/.test(d)?a:"",k=ge[d],T=/[defgprs%]/.test(d);$=$===void 0?6:/[gprs]/.test(d)?Math.max(1,Math.min(21,$)):Math.max(0,Math.min(20,$));function S(w){var E=p,v=_,N,B,O;if(d==="c")v=k(w)+v,w="";else{w=+w;var D=w<0||1/w<0;if(w=isNaN(w)?u:k(Math.abs(w),$),m&&(w=ms(w)),D&&+w==0&&x!=="+"&&(D=!1),E=(D?x==="("?x:s:x==="-"||x==="("?"":x)+E,v=(d==="s"?ye[8+sr/3]:"")+v+(D&&x==="("?")":""),T){for(N=-1,B=w.length;++N<B;)if(O=w.charCodeAt(N),48>O||O>57){v=(O===46?i+w.slice(N+1):w.slice(N))+v,w=w.slice(0,N);break}}}I&&!b&&(w=n(w,1/0));var C=E.length+w.length+v.length,V=C<M?new Array(M-C+1).join(f):"";switch(I&&b&&(w=n(V+w,V.length?M-v.length:1/0),V=""),g){case"<":w=E+w+v+V;break;case"=":w=E+V+w+v;break;case"^":w=V.slice(0,C=V.length>>1)+E+w+v+V.slice(C);break;default:w=V+E+w+v;break}return o(w)}return S.toString=function(){return h+""},S}function c(h,f){var g=l((h=on(h),h.type="f",h)),x=Math.max(-8,Math.min(8,Math.floor(kt(f)/3)))*3,y=Math.pow(10,-x),b=ye[8+x/3];return function(M){return g(y*M)+b}}return{format:l,formatPrefix:c}}var qt,lr,ur;vs({thousands:",",grouping:[3],currency:["$",""]});function vs(t){return qt=xs(t),lr=qt.format,ur=qt.formatPrefix,qt}function ws(t){return Math.max(0,-kt(Math.abs(t)))}function _s(t,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kt(n)/3)))*3-kt(Math.abs(t)))}function bs(t,n){return t=Math.abs(t),n=Math.abs(n)-t,Math.max(0,kt(n)-kt(t))+1}function cn(t,n){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(n).domain(t);break}return this}const xe=Symbol("implicit");function Fn(){var t=new Gn,n=[],e=[],r=xe;function i(o){let a=t.get(o);if(a===void 0){if(r!==xe)return r;t.set(o,a=n.push(o)-1)}return e[a%e.length]}return i.domain=function(o){if(!arguments.length)return n.slice();n=[],t=new Gn;for(const a of o)t.has(a)||t.set(a,n.push(a)-1);return i},i.range=function(o){return arguments.length?(e=Array.from(o),i):e.slice()},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return Fn(n,e).unknown(r)},cn.apply(i,arguments),i}function qn(){var t=Fn().unknown(void 0),n=t.domain,e=t.range,r=0,i=1,o,a,s=!1,u=0,l=0,c=.5;delete t.unknown;function h(){var f=n().length,g=i<r,x=g?i:r,y=g?r:i;o=(y-x)/Math.max(1,f-u+l*2),s&&(o=Math.floor(o)),x+=(y-x-o*(f-u))*c,a=o*(1-u),s&&(x=Math.round(x),a=Math.round(a));var b=Lr(f).map(function(M){return x+o*M});return e(g?b.reverse():b)}return t.domain=function(f){return arguments.length?(n(f),h()):n()},t.range=function(f){return arguments.length?([r,i]=f,r=+r,i=+i,h()):[r,i]},t.rangeRound=function(f){return[r,i]=f,r=+r,i=+i,s=!0,h()},t.bandwidth=function(){return a},t.step=function(){return o},t.round=function(f){return arguments.length?(s=!!f,h()):s},t.padding=function(f){return arguments.length?(u=Math.min(1,l=+f),h()):u},t.paddingInner=function(f){return arguments.length?(u=Math.min(1,f),h()):u},t.paddingOuter=function(f){return arguments.length?(l=+f,h()):l},t.align=function(f){return arguments.length?(c=Math.max(0,Math.min(1,f)),h()):c},t.copy=function(){return qn(n(),[r,i]).round(s).paddingInner(u).paddingOuter(l).align(c)},cn.apply(h(),arguments)}function Ms(t){return function(){return t}}function cr(t){return+t}var ve=[0,1];function vt(t){return t}function In(t,n){return(n-=t=+t)?function(e){return(e-t)/n}:Ms(isNaN(n)?NaN:.5)}function ks(t,n){var e;return t>n&&(e=t,t=n,n=e),function(r){return Math.max(t,Math.min(n,r))}}function $s(t,n,e){var r=t[0],i=t[1],o=n[0],a=n[1];return i<r?(r=In(i,r),o=e(a,o)):(r=In(r,i),o=e(o,a)),function(s){return o(r(s))}}function As(t,n,e){var r=Math.min(t.length,n.length)-1,i=new Array(r),o=new Array(r),a=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),n=n.slice().reverse());++a<r;)i[a]=In(t[a],t[a+1]),o[a]=e(n[a],n[a+1]);return function(s){var u=$r(t,s,1,r)-1;return o[u](i[u](s))}}function Cs(t,n){return n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ns(){var t=ve,n=ve,e=On,r,i,o,a=vt,s,u,l;function c(){var f=Math.min(t.length,n.length);return a!==vt&&(a=ks(t[0],t[f-1])),s=f>2?As:$s,u=l=null,h}function h(f){return f==null||isNaN(f=+f)?o:(u||(u=s(t.map(r),n,e)))(r(a(f)))}return h.invert=function(f){return a(i((l||(l=s(n,t.map(r),tt)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,cr),c()):t.slice()},h.range=function(f){return arguments.length?(n=Array.from(f),c()):n.slice()},h.rangeRound=function(f){return n=Array.from(f),e=Xo,c()},h.clamp=function(f){return arguments.length?(a=f?!0:vt,c()):a!==vt},h.interpolate=function(f){return arguments.length?(e=f,c()):e},h.unknown=function(f){return arguments.length?(o=f,h):o},function(f,g){return r=f,i=g,c()}}function fr(){return Ns()(vt,vt)}function Ss(t,n,e,r){var i=Rr(t,n,e),o;switch(r=on(r??",f"),r.type){case"s":{var a=Math.max(Math.abs(t),Math.abs(n));return r.precision==null&&!isNaN(o=_s(i,a))&&(r.precision=o),ur(r,a)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=bs(i,Math.max(Math.abs(t),Math.abs(n))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=ws(i))&&(r.precision=o-(r.type==="%")*2);break}}return lr(r)}function hr(t){var n=t.domain;return t.ticks=function(e){var r=n();return Tr(r[0],r[r.length-1],e??10)},t.tickFormat=function(e,r){var i=n();return Ss(i[0],i[i.length-1],e??10,r)},t.nice=function(e){e==null&&(e=10);var r=n(),i=0,o=r.length-1,a=r[i],s=r[o],u,l,c=10;for(s<a&&(l=a,a=s,s=l,l=i,i=o,o=l);c-- >0;){if(l=wn(a,s,e),l===u)return r[i]=a,r[o]=s,n(r);if(l>0)a=Math.floor(a/l)*l,s=Math.ceil(s/l)*l;else if(l<0)a=Math.ceil(a*l)/l,s=Math.floor(s*l)/l;else break;u=l}return t},t}function dr(){var t=fr();return t.copy=function(){return Cs(t,dr())},cn.apply(t,arguments),hr(t)}function we(t){return Math.sign(t)*t*t}function Es(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function gr(){var t=fr(),n=[0,1],e=!1,r;function i(o){var a=Es(t(o));return isNaN(a)?r:e?Math.round(a):a}return i.invert=function(o){return t.invert(we(o))},i.domain=function(o){return arguments.length?(t.domain(o),i):t.domain()},i.range=function(o){return arguments.length?(t.range((n=Array.from(o,cr)).map(we)),i):n.slice()},i.rangeRound=function(o){return i.range(o).round(!0)},i.round=function(o){return arguments.length?(e=!!o,i):e},i.clamp=function(o){return arguments.length?(t.clamp(o),i):t.clamp()},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return gr(t.domain(),n).round(e).clamp(t.clamp()).unknown(r)},cn.apply(i,arguments),hr(i)}function J(t){return function(){return t}}const _e=Math.abs,q=Math.atan2,ft=Math.cos,Is=Math.max,yn=Math.min,it=Math.sin,wt=Math.sqrt,X=1e-12,Lt=Math.PI,an=Lt/2,Ts=2*Lt;function Rs(t){return t>1?0:t<-1?Lt:Math.acos(t)}function be(t){return t>=1?an:t<=-1?-an:Math.asin(t)}function Ls(t){let n=3;return t.digits=function(e){if(!arguments.length)return n;if(e==null)n=null;else{const r=Math.floor(e);if(!(r>=0))throw new RangeError(`invalid digits: ${e}`);n=r}return t},()=>new cs(n)}function Ps(t){return t.innerRadius}function Os(t){return t.outerRadius}function zs(t){return t.startAngle}function Bs(t){return t.endAngle}function Vs(t){return t&&t.padAngle}function Ds(t,n,e,r,i,o,a,s){var u=e-t,l=r-n,c=a-i,h=s-o,f=h*u-c*l;if(!(f*f<X))return f=(c*(n-o)-h*(t-i))/f,[t+f*u,n+f*l]}function Wt(t,n,e,r,i,o,a){var s=t-e,u=n-r,l=(a?o:-o)/wt(s*s+u*u),c=l*u,h=-l*s,f=t+c,g=n+h,x=e+c,y=r+h,b=(f+x)/2,M=(g+y)/2,I=x-f,$=y-g,m=I*I+$*$,d=i-o,p=f*y-x*g,_=($<0?-1:1)*wt(Is(0,d*d*m-p*p)),k=(p*$-I*_)/m,T=(-p*I-$*_)/m,S=(p*$+I*_)/m,w=(-p*I+$*_)/m,E=k-b,v=T-M,N=S-b,B=w-M;return E*E+v*v>N*N+B*B&&(k=S,T=w),{cx:k,cy:T,x01:-c,y01:-h,x11:k*(i/d-1),y11:T*(i/d-1)}}function Fs(){var t=Ps,n=Os,e=J(0),r=null,i=zs,o=Bs,a=Vs,s=null,u=Ls(l);function l(){var c,h,f=+t.apply(this,arguments),g=+n.apply(this,arguments),x=i.apply(this,arguments)-an,y=o.apply(this,arguments)-an,b=_e(y-x),M=y>x;if(s||(s=c=u()),g<f&&(h=g,g=f,f=h),!(g>X))s.moveTo(0,0);else if(b>Ts-X)s.moveTo(g*ft(x),g*it(x)),s.arc(0,0,g,x,y,!M),f>X&&(s.moveTo(f*ft(y),f*it(y)),s.arc(0,0,f,y,x,M));else{var I=x,$=y,m=x,d=y,p=b,_=b,k=a.apply(this,arguments)/2,T=k>X&&(r?+r.apply(this,arguments):wt(f*f+g*g)),S=yn(_e(g-f)/2,+e.apply(this,arguments)),w=S,E=S,v,N;if(T>X){var B=be(T/f*it(k)),O=be(T/g*it(k));(p-=B*2)>X?(B*=M?1:-1,m+=B,d-=B):(p=0,m=d=(x+y)/2),(_-=O*2)>X?(O*=M?1:-1,I+=O,$-=O):(_=0,I=$=(x+y)/2)}var D=g*ft(I),C=g*it(I),V=f*ft(d),ct=f*it(d);if(S>X){var rt=g*ft($),A=g*it($),L=f*ft(m),F=f*it(m),z;if(b<Lt)if(z=Ds(D,C,L,F,rt,A,V,ct)){var G=D-z[0],K=C-z[1],W=rt-z[0],Z=A-z[1],P=1/it(Rs((G*W+K*Z)/(wt(G*G+K*K)*wt(W*W+Z*Z)))/2),R=wt(z[0]*z[0]+z[1]*z[1]);w=yn(S,(f-R)/(P-1)),E=yn(S,(g-R)/(P+1))}else w=E=0}_>X?E>X?(v=Wt(L,F,D,C,g,E,M),N=Wt(rt,A,V,ct,g,E,M),s.moveTo(v.cx+v.x01,v.cy+v.y01),E<S?s.arc(v.cx,v.cy,E,q(v.y01,v.x01),q(N.y01,N.x01),!M):(s.arc(v.cx,v.cy,E,q(v.y01,v.x01),q(v.y11,v.x11),!M),s.arc(0,0,g,q(v.cy+v.y11,v.cx+v.x11),q(N.cy+N.y11,N.cx+N.x11),!M),s.arc(N.cx,N.cy,E,q(N.y11,N.x11),q(N.y01,N.x01),!M))):(s.moveTo(D,C),s.arc(0,0,g,I,$,!M)):s.moveTo(D,C),!(f>X)||!(p>X)?s.lineTo(V,ct):w>X?(v=Wt(V,ct,rt,A,f,-w,M),N=Wt(D,C,L,F,f,-w,M),s.lineTo(v.cx+v.x01,v.cy+v.y01),w<S?s.arc(v.cx,v.cy,w,q(v.y01,v.x01),q(N.y01,N.x01),!M):(s.arc(v.cx,v.cy,w,q(v.y01,v.x01),q(v.y11,v.x11),!M),s.arc(0,0,f,q(v.cy+v.y11,v.cx+v.x11),q(N.cy+N.y11,N.cx+N.x11),M),s.arc(N.cx,N.cy,w,q(N.y11,N.x11),q(N.y01,N.x01),!M))):s.arc(0,0,f,d,m,M)}if(s.closePath(),c)return s=null,c+""||null}return l.centroid=function(){var c=(+t.apply(this,arguments)+ +n.apply(this,arguments))/2,h=(+i.apply(this,arguments)+ +o.apply(this,arguments))/2-Lt/2;return[ft(h)*c,it(h)*c]},l.innerRadius=function(c){return arguments.length?(t=typeof c=="function"?c:J(+c),l):t},l.outerRadius=function(c){return arguments.length?(n=typeof c=="function"?c:J(+c),l):n},l.cornerRadius=function(c){return arguments.length?(e=typeof c=="function"?c:J(+c),l):e},l.padRadius=function(c){return arguments.length?(r=c==null?null:typeof c=="function"?c:J(+c),l):r},l.startAngle=function(c){return arguments.length?(i=typeof c=="function"?c:J(+c),l):i},l.endAngle=function(c){return arguments.length?(o=typeof c=="function"?c:J(+c),l):o},l.padAngle=function(c){return arguments.length?(a=typeof c=="function"?c:J(+c),l):a},l.context=function(c){return arguments.length?(s=c??null,l):s},l}function qs(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Me(t,n){if((a=t.length)>1)for(var e=1,r,i,o=t[n[0]],a,s=o.length;e<a;++e)for(i=o,o=t[n[e]],r=0;r<s;++r)o[r][1]+=o[r][0]=isNaN(i[r][1])?i[r][0]:i[r][1]}function ke(t){for(var n=t.length,e=new Array(n);--n>=0;)e[n]=n;return e}function Ws(t,n){return t[n]}function Hs(t){const n=[];return n.key=t,n}function Xs(){var t=J([]),n=ke,e=Me,r=Ws;function i(o){var a=Array.from(t.apply(this,arguments),Hs),s,u=a.length,l=-1,c;for(const h of o)for(s=0,++l;s<u;++s)(a[s][l]=[0,+r(h,a[s].key,l,o)]).data=h;for(s=0,c=qs(n(a));s<u;++s)a[c[s]].index=s;return e(a,c),a}return i.keys=function(o){return arguments.length?(t=typeof o=="function"?o:J(Array.from(o)),i):t},i.value=function(o){return arguments.length?(r=typeof o=="function"?o:J(+o),i):r},i.order=function(o){return arguments.length?(n=o==null?ke:typeof o=="function"?o:J(Array.from(o)),i):n},i.offset=function(o){return arguments.length?(e=o??Me,i):e},i}function Et(t,n,e){this.k=t,this.x=n,this.y=e}Et.prototype={constructor:Et,scale:function(t){return t===1?this:new Et(this.k*t,this.x,this.y)},translate:function(t,n){return t===0&n===0?this:new Et(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Et.prototype;const lt={default:"#69b3a2",secondary:"#278872",hover:"#ff7d12"};class Ys{constructor(n,e,r){this.parentElementId=n,this.data=e,this.onClick=r,this.selected=null}initVis(){const n=this,{data:e,parentElementId:r}=this;var i={top:100,right:0,bottom:0,left:0},o=500-i.left-i.right,a=600-i.top-i.bottom,s=90,u=230;const l=gt("#"+r).append("svg").attr("width",o+i.left+i.right).attr("height",a+i.top+i.bottom),c=l.append("g").attr("transform","translate("+(o/2-25)+","+(a/2+i.top-10)+")"),h={},f={};e.forEach(p=>{const _=h[p.label]??{label:p.label,_total:0};_[p.key]=p.value,_._total+=p.value,h[p.label]=_,f[p.key]=1});const g=Object.keys(f),x=Object.values(h);var y=qn().range([0,2*Math.PI]).align(0).domain(e.map(function(p){return p.label})),b=gr().range([s,u]).domain([0,Te(x,p=>p._total)]);const M=l.append("text").attr("x",o/2).attr("y",35),I=l.append("rect").attr("stroke",lt.secondary).attr("stroke-width",1).attr("fill","none").attr("x",M.node().getBoundingClientRect().x).attr("y",M.node().getBoundingClientRect().y).attr("width",M.node().getBoundingClientRect().width).attr("height",M.node().getBoundingClientRect().height),$=p=>{M.text(p),M.attr("x",(o-M.node().getComputedTextLength())/2),I.attr("x",M.attr("x")-10).attr("y",M.attr("y")-M.node().getBoundingClientRect().height).attr("width",M.node().getBoundingClientRect().width+20).attr("height",M.node().getBoundingClientRect().height+10),p===""&&I.attr("width",0)},m=["Online","Local"],d=c.append("g").selectAll("g").data(m).enter().append("g").attr("transform",function(p,_){return"translate(-40,"+(_-1)*20+")"});d.append("rect").attr("width",18).attr("height",18).attr("fill",Fn().range([lt.default,lt.secondary]).domain(m)),d.append("text").attr("x",24).attr("y",9).attr("dy","0.35em").text(function(p){return p}),n.barObjects=Object.fromEntries(x.map(p=>[p.label,[]])),c.append("g").selectAll("g").data(Xs().keys(g)(x)).enter().append("g").selectAll("path").data(p=>p).enter().append("path").attr("fill",p=>p[0]!==0?lt.secondary:lt.default).attr("d",Fs().innerRadius(p=>b(isNaN(p[0])?0:p[0])).outerRadius(function(p){return b(isNaN(p[1])?p[0]:p[1])}).startAngle(function(p){return y(p.data.label)}).endAngle(function(p){return y(p.data.label)+y.bandwidth()}).padAngle(.01).padRadius(s)).style("cursor","pointer").each(function(p){n.barObjects[p.data.label].push([p,this])}).on("mouseover",function(p,_){n.highlightCategory(_.data.label),_.data.label!==n.selected&&n.onClick(_.data.label);const k=(isNaN(_[1])?_[0]:_[1])-(isNaN(_[0])?0:_[0]);$(`${k} mention${k===1?"":"s"} (total: ${_.data._total})`)}).on("mouseout",function(p,_){if(n.colorCategory(_.data.label),n.selected){const k=n.barObjects[n.selected][0][0],T=(isNaN(k[1])?k[0]:k[1])-(isNaN(k[0])?0:k[0]);$(`${T} mention${T===1?"":"s"} (total: ${k.data._total})`),k.data.label!==_.data.label&&n.onClick(k.data.label)}else n.onClick(null),$("")}).on("click",function(p,_){n.changeSelected(_.data.label),n.selected?n.onClick(_.data.label):n.onClick(null)}),c.append("g").selectAll("g").data(x).enter().append("g").attr("text-anchor",function(p){return(y(p.label)+y.bandwidth()/2+Math.PI)%(2*Math.PI)<Math.PI?"end":"start"}).attr("transform",function(p){return"rotate("+((y(p.label)+y.bandwidth()/2)*180/Math.PI-90)+")translate("+(b(p._total)+10)+",0)"}).append("text").text(function(p){return p.label}).attr("transform",function(p){return(y(p.label)+y.bandwidth()/2+Math.PI)%(2*Math.PI)<Math.PI?"rotate(180)":"rotate(0)"}).style("font-size","11px").attr("alignment-baseline","middle")}changeSelected(n){const e=this.selected;this.selected=this.selected===n?null:n,n&&this.highlightCategory(n),e&&this.colorCategory(e)}colorCategory(n){for(const[e,r]of this.barObjects[n])gt(r).style("fill",e.data.label===this.selected?lt.hover:e[0]!==0?lt.secondary:lt.default)}highlightCategory(n){for(const[e,r]of this.barObjects[n])gt(r).style("fill",lt.hover)}}function Gs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Us(t){if(t.__esModule)return t;var n=t.default;if(typeof n=="function"){var e=function r(){return this instanceof r?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};e.prototype=n.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),e}var Js={value:function(){}};function pr(){for(var t=0,n=arguments.length,e={},r;t<n;++t){if(!(r=arguments[t]+"")||r in e||/[\s.]/.test(r))throw new Error("illegal type: "+r);e[r]=[]}return new Ut(e)}function Ut(t){this._=t}function Ks(t,n){return t.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");if(i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),e&&!n.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}Ut.prototype=pr.prototype={constructor:Ut,on:function(t,n){var e=this._,r=Ks(t+"",e),i,o=-1,a=r.length;if(arguments.length<2){for(;++o<a;)if((i=(t=r[o]).type)&&(i=Zs(e[i],t.name)))return i;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++o<a;)if(i=(t=r[o]).type)e[i]=$e(e[i],t.name,n);else if(n==null)for(i in e)e[i]=$e(e[i],t.name,null);return this},copy:function(){var t={},n=this._;for(var e in n)t[e]=n[e].slice();return new Ut(t)},call:function(t,n){if((i=arguments.length-2)>0)for(var e=new Array(i),r=0,i,o;r<i;++r)e[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,i=o.length;r<i;++r)o[r].value.apply(n,e)},apply:function(t,n,e){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(n,e)}};function Zs(t,n){for(var e=0,r=t.length,i;e<r;++e)if((i=t[e]).name===n)return i.value}function $e(t,n,e){for(var r=0,i=t.length;r<i;++r)if(t[r].name===n){t[r]=Js,t=t.slice(0,r).concat(t.slice(r+1));break}return e!=null&&t.push({name:n,value:e}),t}const Qs=Object.freeze(Object.defineProperty({__proto__:null,dispatch:pr},Symbol.toStringTag,{value:"Module"})),js=Us(Qs);var xn,Ae;function tl(){if(Ae)return xn;Ae=1;const t=js.dispatch,n=Math.PI/180,e={archimedean:y,rectangular:b},r=64,i=2048;xn=function(){var m=[256,256],d=o,p=a,_=u,k=s,T=s,S=l,w=c,E=y,v=[],N=1/0,B=t("word","end"),O=null,D=Math.random,C={},V=I;C.canvas=function(A){return arguments.length?(V=$(A),C):V},C.start=function(){var A=ct(V()),L=M((m[0]>>5)*m[1]),F=null,z=v.length,G=-1,K=[],W=v.map(function(P,R){return P.text=d.call(this,P,R),P.font=p.call(this,P,R),P.style=k.call(this,P,R),P.weight=T.call(this,P,R),P.rotate=S.call(this,P,R),P.size=~~_.call(this,P,R),P.padding=w.call(this,P,R),P}).sort(function(P,R){return R.size-P.size});return O&&clearInterval(O),O=setInterval(Z,0),Z(),C;function Z(){for(var P=Date.now();Date.now()-P<N&&++G<z&&O;){var R=W[G];R.x=m[0]*(D()+.5)>>1,R.y=m[1]*(D()+.5)>>1,h(A,R,W,G),R.hasText&&rt(L,R,F)&&(K.push(R),B.call("word",C,R),F?g(F,R):F=[{x:R.x+R.x0,y:R.y+R.y0},{x:R.x+R.x1,y:R.y+R.y1}],R.x-=m[0]>>1,R.y-=m[1]>>1)}G>=z&&(C.stop(),B.call("end",C,K,F))}},C.stop=function(){O&&(clearInterval(O),O=null);for(const A of v)delete A.sprite;return C};function ct(A){const L=A.getContext("2d",{willReadFrequently:!0});A.width=A.height=1;const F=Math.sqrt(L.getImageData(0,0,1,1).data.length>>2);return A.width=(r<<5)/F,A.height=i/F,L.fillStyle=L.strokeStyle="red",{context:L,ratio:F}}function rt(A,L,F){m[0],m[1];for(var z=L.x,G=L.y,K=Math.sqrt(m[0]*m[0]+m[1]*m[1]),W=E(m),Z=D()<.5?1:-1,P=-Z,R,xt,H;(R=W(P+=Z))&&(xt=~~R[0],H=~~R[1],!(Math.min(Math.abs(xt),Math.abs(H))>=K));)if(L.x=z+xt,L.y=G+H,!(L.x+L.x0<0||L.y+L.y0<0||L.x+L.x1>m[0]||L.y+L.y1>m[1])&&(!F||x(L,F))&&!f(L,A,m[0])){for(var Q=L.sprite,zt=L.width>>5,Wn=m[0]>>5,Hn=L.x-(zt<<4),Xn=Hn&127,yr=32-Xn,xr=L.y1-L.y0,Yn=(L.y+L.y0)*Wn+(Hn>>5),fn,hn=0;hn<xr;hn++){fn=0;for(var $t=0;$t<=zt;$t++)A[Yn+$t]|=fn<<yr|($t<zt?(fn=Q[hn*zt+$t])>>>Xn:0);Yn+=Wn}return!0}return!1}return C.timeInterval=function(A){return arguments.length?(N=A??1/0,C):N},C.words=function(A){return arguments.length?(v=A,C):v},C.size=function(A){return arguments.length?(m=[+A[0],+A[1]],C):m},C.font=function(A){return arguments.length?(p=$(A),C):p},C.fontStyle=function(A){return arguments.length?(k=$(A),C):k},C.fontWeight=function(A){return arguments.length?(T=$(A),C):T},C.rotate=function(A){return arguments.length?(S=$(A),C):S},C.text=function(A){return arguments.length?(d=$(A),C):d},C.spiral=function(A){return arguments.length?(E=e[A]||A,C):E},C.fontSize=function(A){return arguments.length?(_=$(A),C):_},C.padding=function(A){return arguments.length?(w=$(A),C):w},C.random=function(A){return arguments.length?(D=A,C):D},C.on=function(){var A=B.on.apply(B,arguments);return A===B?C:A},C};function o(m){return m.text}function a(){return"serif"}function s(){return"normal"}function u(m){return Math.sqrt(m.value)}function l(){return(~~(random()*6)-3)*30}function c(){return 1}function h(m,d,p,_){if(!d.sprite){var k=m.context,T=m.ratio;k.clearRect(0,0,(r<<5)/T,i/T);var S=0,w=0,E=0,v=p.length;for(--_;++_<v;){d=p[_],k.save(),k.font=d.style+" "+d.weight+" "+~~((d.size+1)/T)+"px "+d.font;const R=k.measureText(d.text),xt=-Math.floor(R.width/2);let H=(R.width+1)*T,Q=d.size<<1;if(d.rotate){var N=Math.sin(d.rotate*n),B=Math.cos(d.rotate*n),O=H*B,D=H*N,C=Q*B,V=Q*N;H=Math.max(Math.abs(O+V),Math.abs(O-V))+31>>5<<5,Q=~~Math.max(Math.abs(D+C),Math.abs(D-C))}else H=H+31>>5<<5;if(Q>E&&(E=Q),S+H>=r<<5&&(S=0,w+=E,E=0),w+Q>=i)break;k.translate((S+(H>>1))/T,(w+(Q>>1))/T),d.rotate&&k.rotate(d.rotate*n),k.fillText(d.text,xt,0),d.padding&&(k.lineWidth=2*d.padding,k.strokeText(d.text,xt,0)),k.restore(),d.width=H,d.height=Q,d.xoff=S,d.yoff=w,d.x1=H>>1,d.y1=Q>>1,d.x0=-d.x1,d.y0=-d.y1,d.hasText=!0,S+=H}for(var ct=k.getImageData(0,0,(r<<5)/T,i/T).data,rt=[];--_>=0;)if(d=p[_],!!d.hasText){for(var A=d.width,L=A>>5,F=d.y1-d.y0,z=0;z<F*L;z++)rt[z]=0;if(S=d.xoff,S==null)return;w=d.yoff;for(var G=0,K=-1,W=0;W<F;W++){for(var z=0;z<A;z++){var Z=L*W+(z>>5),P=ct[(w+W)*(r<<5)+(S+z)<<2]?1<<31-z%32:0;rt[Z]|=P,G|=P}G?K=W:(d.y0++,F--,W--,w++)}d.y1=d.y0+K,d.sprite=rt.slice(0,(d.y1-d.y0)*L)}}}function f(m,d,p){p>>=5;for(var _=m.sprite,k=m.width>>5,T=m.x-(k<<4),S=T&127,w=32-S,E=m.y1-m.y0,v=(m.y+m.y0)*p+(T>>5),N,B=0;B<E;B++){N=0;for(var O=0;O<=k;O++)if((N<<w|(O<k?(N=_[B*k+O])>>>S:0))&d[v+O])return!0;v+=p}return!1}function g(m,d){var p=m[0],_=m[1];d.x+d.x0<p.x&&(p.x=d.x+d.x0),d.y+d.y0<p.y&&(p.y=d.y+d.y0),d.x+d.x1>_.x&&(_.x=d.x+d.x1),d.y+d.y1>_.y&&(_.y=d.y+d.y1)}function x(m,d){return m.x+m.x1>d[0].x&&m.x+m.x0<d[1].x&&m.y+m.y1>d[0].y&&m.y+m.y0<d[1].y}function y(m){var d=m[0]/m[1];return function(p){return[d*(p*=.1)*Math.cos(p),p*Math.sin(p)]}}function b(m){var d=4,p=d*m[0]/m[1],_=0,k=0;return function(T){var S=T<0?-1:1;switch(Math.sqrt(1+4*S*T)-S&3){case 0:_+=p;break;case 1:k+=d;break;case 2:_-=p;break;default:k-=d;break}return[_,k]}}function M(m){for(var d=[],p=-1;++p<m;)d[p]=0;return d}function I(){return document.createElement("canvas")}function $(m){return typeof m=="function"?m:function(){return m}}return xn}var nl=tl();const el=Gs(nl),vn={default:"#69b3a2",hover:"#ff7d12"};class rl{constructor(n,e,{width:r,height:i},o,a){this.parentElementId=n,this.words=e,this.margin={top:10,right:10,bottom:10,left:10},this.width=r-this.margin.left-this.margin.right,this.height=i-this.margin.top-this.margin.bottom,this.onHover=o,this.onClick=a,this.selected=null}initVis(){const n=this,{margin:e,width:r,height:i}=this;n.svg=gt("#"+n.parentElementId).append("svg").attr("width",r+e.left+e.right).attr("height",i+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");var o=el().size([r,i]).words(n.words.map(function(u){return{text:u.word,size:u.size}})).padding(5).rotate(function(){return~~(Math.random()*6-3)*30}).fontSize(function(u){return u.size}).on("end",s);o.start();const a=Object.fromEntries(n.words.map(u=>[u.word,u]));function s(u){n.layoutWords=u,n.svg.append("g").attr("transform","translate("+o.size()[0]/2+","+o.size()[1]/2+")").selectAll("text").data(u).enter().append("text").style("font-size",function(l){return l.size}).style("fill",vn.default).attr("text-anchor","middle").style("font-family","Impact").attr("transform",function(l){return"translate("+[l.x,l.y]+")rotate("+l.rotate+")"}).style("cursor","pointer").on("mouseover",function(l,c){n.highlightWord(c.text),n.onHover(a[c.text])}).on("mouseout",function(){n.highlightWord(n.selected),n.onHover(a[n.selected])}).on("click",function(l,c){n.onClick(n.selected===c.text?null:c.text)}).text(function(l){return l.text})}}selectWord(n){this.selected=n,this.highlightWord(n)}highlightWord(n){const e=this;e.svg.selectAll("text").data(e.layoutWords).transition().duration(0).style("fill",r=>r.text===n||n==null&&r.text===this.selected?vn.hover:vn.default)}}const Ce={default:"#69b3a2",hover:"#ff7d12"},il={primary:Ce.default,hover:Ce.hover};class mr{constructor({data:n,getX:e,getY:r,dims:i,onClick:o,onHover:a,selected:s,colors:u=il}){this.data=n,this.getX=e,this.getY=r,this.dims=i,this.onClick=o,this.onHover=a,this.selected=s,this.colors=u}draw(n){const{data:e,getX:r,getY:i,dims:o,colors:{primary:a,hover:s}}=this,u=this,{margin:l,width:c,height:h}=o;u.group=n.append("g").attr("transform","translate("+l.left+","+l.top+")");const f=u.group,{x:g,y:x}=Se(e,{width:c,height:h,getX:r,getY:i});u.xAxis=f.append("g").attr("transform","translate(0,"+h+")").call(Kn(g)),u.xAxis.selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end"),u.yAxis=f.append("g").call(Zn(x).tickFormat(Ne)),u.barGroup=f.selectAll("rect"),u.bars=u.barGroup.data(e).enter().append("rect").attr("x",y=>g(r(y))).attr("y",y=>x(i(y))).attr("width",g.bandwidth()).attr("height",function(y){return h-x(i(y))}).style("fill",y=>r(y)===u.selected?s:a).style("cursor",this.onClick?"pointer":null).on("mouseover",function(y,b){gt(this).style("fill",s),u.highlightBar(r(b)),u.onHover&&u.onHover(b)}).on("mouseout",function(y,b){u.highlightBar(u.selected),u.onHover&&u.onHover(u.selected)}),u.onClick&&u.bars.on("click",(y,b)=>{r(b)===u.selected?u.onClick(null):u.onClick(r(b)),u.update(this.data)})}update(n){const{dims:e,getX:r,getY:i}=this,o=this;o.data=n;const{width:a,height:s}=e,{x:u,y:l}=Se(n,{width:a,height:s,getX:r,getY:i});this.xAxis.transition().duration(400).call(Kn(u)),this.yAxis.transition().duration(400).call(Zn(l).tickFormat(Ne));const c=o.group.selectAll("rect").data(n);c.transition().style("fill",h=>r(h)===o.selected?o.colors.hover:o.colors.primary).attr("x",h=>u(r(h))).attr("y",h=>l(i(h))).attr("width",u.bandwidth()).attr("height",function(h){return s-l(i(h))}),c.exit().transition().attr("height",0).remove()}setSelected(n){this.selected=n,this.highlightBar(n)}highlightBar(n){this.group.selectAll("rect").data(this.data).transition().duration(0).style("fill",r=>this.getX(r)===n?this.colors.hover:this.colors.primary)}}function Ne(t){return t%1?null:t}function Se(t,{height:n,getY:e,width:r,getX:i}){const o=dr().domain([0,Te(t.map(e))]).range([n,0]);return{x:qn().range([0,r]).domain(t.map(i)).padding(.2),y:o}}class ol{constructor({parentElement:n,profile:e,onClick:r,selected:i,localLocationData:o}){this.parentElement=n,this.profile=e,this.onClick=r,this.selected=i,this.localLocationData=o,console.log(this.localLocationData)}defaultBarGraphDimensions(){const n={top:30,right:30,bottom:70,left:60},e=460-n.left-n.right,r=400-n.top-n.bottom;return{margin:n,width:e,height:r}}async addVis43ToSvg(n,e,r,i,o){const a=this.localLocationData,s={};a.filter(({Person:c})=>c===e).forEach(({location:{category:c}})=>{s[c]=(s[c]??0)+1});const u=Object.entries(s).map(([c,h])=>({category:c,count:h})).sort((c,h)=>h.count-c.count);console.log(u);const l=new mr({data:u,getX:c=>c.category,getY:c=>c.count,dims:r,selected:i,onClick:o});return l.draw(n),l}async render(){const n=gt(this.parentElement).append("svg").attr("width","100%"),e=n.append("text").text(this.profile.Person).attr("y",30).attr("class","text-2xl"),r=e.node().getBBox(),i=n.append("text").text(`Lived in Toronto for ${this.profile.length_in_toronto} years.`).attr("y",+e.attr("y")+r.height-8).attr("class","text-lg"),o=i.node().getBBox(),a=n.node().getBoundingClientRect().width;let s=+i.attr("y")+o.height+8;const u=[n.append("text").attr("y",s)];this.profile.description.split(" ").forEach(x=>{const y=u[u.length-1],b=y.text();y.text(`${b} ${x}`),y.node().getComputedTextLength()>a&&(y.text(b),s+=y.node().getBBox().height,u.push(n.append("text").attr("y",s).text(x)))});const l=u[u.length-1],c=+l.attr("y")+l.node().getBBox().height,h=this.defaultBarGraphDimensions(),f=n.append("g").attr("transform",`translate(0, ${c})`),g=f.append("text").text(`Categories mentioned by ${this.profile.Person}`).attr("y",10).attr("class","text-lg");g.attr("x",(a-g.node().getComputedTextLength())/2),this.barViz=await this.addVis43ToSvg(f,this.profile.Person,h,this.selected,this.onClick),n.attr("height",c+f.node().getBBox().height)}highlightBar(n){this.barViz.highlightBar(n)}}let j,Ee,al=[Ft("/data/locations_data.json"),Ft("/data/online_mentions.json"),Ft("/data/person_info.json"),Ft("/data/local_mentions.json")];Promise.all(al).then(function(t){sl(t)}).catch(function(t){console.log(t)});function sl(t){const n=t[0],e=t[1],r=t[2],i=t[3],o=JSON.parse(JSON.stringify(n)),a=JSON.parse(JSON.stringify(i)),s=Object.fromEntries(o.map(d=>[d.location_id,d])),u=a.map(d=>({...d,location:s[d.location_id]}));document.getElementById("personSort").innerHTML=`
  <div id="accordion-collapse" data-accordion="collapse">
    ${r.map((d,p)=>`
      <h2 id="accordion-collapse-heading-${p}">
        <button type="button" class="accordion-button flex items-center justify-between w-full p-3 font-medium rtl:text-right text-gray-500 border border-b-0 border-gray-200 rounded-t-xl focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 gap-3" data-accordion-target="#accordion-collapse-body-${p}" aria-expanded="false" aria-controls="accordion-collapse-body-${p}" data-person="${d.Person}">
          <span>${d.Person}</span>
          <svg data-accordion-icon class="w-3 h-3 shrink-0 rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
          </svg>
        </button>
      </h2>
      <div id="accordion-collapse-body-${p}" class="accordion-body hidden" aria-labelledby="accordion-collapse-heading-${p}">
        <div id="profile-container-${p}" class="p-5 border border-b-0 border-gray-200 dark:border-gray-700">
          <!-- ProfileViz will be rendered here -->
        </div>
      </div>
    `).join("")}
  </div>`,j=new wr(n,e,r,i,d=>d.length>0?f(d[0].Name):null,()=>f()),j.initVis();const l=ll(cl(n,e),ul(n,i));document.getElementById("backButton").addEventListener("click",function(){document.getElementById("personSort").classList.add("hidden"),document.getElementById("radialVis").classList.add("hidden"),document.getElementById("wordCloudVis").classList.add("hidden"),document.getElementById("choose").classList.add("block"),document.getElementById("choose").classList.remove("hidden"),document.getElementById("backButton").classList.add("hidden"),j.updateVis(null,null,null)}),document.querySelectorAll(".accordion-button").forEach(d=>{d.addEventListener("click",function(){const p=this.getAttribute("data-accordion-target"),_=document.querySelector(p);document.querySelectorAll(".accordion-button").forEach(S=>{if(S!==this){const w=S.getAttribute("data-accordion-target"),E=document.querySelector(w);S.setAttribute("aria-expanded","false"),E.classList.add("hidden"),S.querySelector("[data-accordion-icon]").classList.add("rotate-180")}});const k=this.getAttribute("aria-expanded")==="true";if(this.setAttribute("aria-expanded",!k),_.classList.toggle("hidden",k),this.querySelector("[data-accordion-icon]").classList.toggle("rotate-180",k),k)j.updateVis(null,null,null);else{const S=document.getElementById(`profile-container-${p.split("-").pop()}`);S.innerHTML="",new ol({parentElement:S,profile:r.find(E=>E.Person===this.getAttribute("data-person")),localLocationData:u}).render(),j.updateVis(this.getAttribute("data-person"),null,null)}})});const h=d=>{j.updateVis(null,null,d)};Ee=new Ys("radialVis",l,h),Ee.initVis();function f(d){y.selectWord(d),$.setSelected(d),d==null&&j.closeInfoWindow()}const g=e.map(d=>({word:d.Name,size:fl(d.count),location_id:d.location_id}));function x(d){d==null?(j.closeInfoWindow(),$.highlightBar()):(j.openInfoWindow(d.location_id),$.highlightBar(d.word))}const y=new rl("wordCloudVis",g,{width:window.innerWidth*.45,height:450},x,f);y.initVis();const b={top:30,right:30,bottom:70,left:60},M=window.innerWidth*.45-(b.left+b.right),I=400-b.top-b.bottom,$=new mr({data:e,getX:d=>d.Name,getY:d=>d.count,dims:{margin:b,width:M,height:I},onHover:d=>{d==null?(j.closeInfoWindow(),y.highlightWord()):(j.openInfoWindow(d.location_id),y.highlightWord(d.Name))},onClick:f}),m=gt("#wordCloudVis").append("svg").attr("width",M+b.left+b.right).attr("height",I+b.top+b.bottom+50);$.draw(m)}function ll(t,n){let e={};t.forEach(({location:{category:i}})=>{e[i]=(e[i]??0)+1});const r=Object.entries(e).map(([i,o])=>({label:i,value:o,key:1})).sort((i,o)=>o.value-i.value);return e={},n.forEach(({location:{category:i}})=>{e[i]=(e[i]??0)+1}),Object.entries(e).forEach(([i,o])=>r.push({label:i,value:o,key:2})),r}function ul(t,n){const e=Object.fromEntries(t.map(r=>[r.location_id,r]));return n.map(r=>({...r,location:e[r.location_id]}))}function cl(t,n){const e=Object.fromEntries(t.map(r=>[r.location_id,r]));return n.map(r=>({...r,location:e[r.location_id]}))}function fl(t){return(Math.tanh((t-15)/15)+1)*30+5}
